<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scene 10: Barbara Liskov - SHE<Codes/></title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #0a0a0a;
            overflow: hidden;
            height: 100vh;
        }

        /* Game Container */
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: url('images/university-lab.jpg') center center no-repeat;
            background-size: cover;
            background-color: #1a1a1a;
        }

        /* Advanced Level Intro Screen */
        .advanced-intro {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3a 50%, #0a0a1a 100%);
            z-index: 4000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            animation: introFade 8s ease-out forwards;
        }

        @keyframes introFade {
            0% { opacity: 1; }
            85% { opacity: 1; }
            100% { opacity: 0; pointer-events: none; }
        }

        .guardian-symbol {
            width: 150px;
            height: 150px;
            border: 5px solid #ffd700;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            margin-bottom: 40px;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.2) 0%, transparent 70%);
            animation: symbolRotate 4s linear infinite;
            position: relative;
        }

        @keyframes symbolRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .guardian-symbol::before {
            content: 'âš¡';
            position: absolute;
            animation: symbolRotate 4s linear infinite reverse;
        }

        .intro-title {
            font-size: 3.5rem;
            color: #ffd700;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.9);
            margin-bottom: 20px;
            animation: titlePulse 2s ease-in-out infinite;
            text-align: center;
        }

        @keyframes titlePulse {
            0%, 100% { transform: scale(1); text-shadow: 0 0 30px rgba(255, 215, 0, 0.9); }
            50% { transform: scale(1.05); text-shadow: 0 0 50px rgba(255, 215, 0, 1); }
        }

        .intro-subtitle {
            font-size: 1.8rem;
            color: #ffffff;
            margin-bottom: 50px;
            text-align: center;
        }

        .intro-message {
            font-size: 1.3rem;
            color: #e0e0e0;
            text-align: center;
            max-width: 800px;
            line-height: 1.8;
            margin-bottom: 40px;
            padding: 0 30px;
        }

        .challenge-list {
            background: rgba(0, 0, 0, 0.6);
            border: 3px solid #ffd700;
            border-radius: 15px;
            padding: 30px 50px;
            margin-top: 30px;
        }

        .challenge-item {
            display: flex;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
            font-size: 1.2rem;
            color: #ffffff;
        }

        .challenge-icon {
            font-size: 2rem;
            color: #ffd700;
        }

        .challenge-text {
            flex: 1;
        }

        .challenge-difficulty {
            color: #ff6b9d;
            font-weight: bold;
        }

        .ready-message {
            font-size: 1.5rem;
            color: #ffd700;
            margin-top: 50px;
            animation: blink 1.5s ease-in-out infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* Time transition */
        .time-transition {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2a2a4a 0%, #1a1a3a 50%, #2a2a4a 100%);
            z-index: 3500;
            display: none;
            animation: timeShift 3s ease-out forwards;
            pointer-events: none;
        }

        .time-transition.active {
            display: block;
        }

        @keyframes timeShift {
            0% { opacity: 1; }
            70% { opacity: 1; }
            100% { opacity: 0; }
        }

        .digital-grid {
            position: absolute;
            width: 100%;
            height: 100%;
            background: 
                repeating-linear-gradient(0deg, transparent, transparent 50px, rgba(255, 215, 0, 0.1) 50px, rgba(255, 215, 0, 0.1) 51px),
                repeating-linear-gradient(90deg, transparent, transparent 50px, rgba(255, 215, 0, 0.1) 50px, rgba(255, 215, 0, 0.1) 51px);
            animation: gridMove 2s linear infinite;
        }

        @keyframes gridMove {
            from { transform: translate(0, 0); }
            to { transform: translate(50px, 50px); }
        }

        /* University Lab Elements */
        .crt-monitor {
            position: absolute;
            width: 200px;
            height: 180px;
            background: linear-gradient(135deg, #d4d4d4 0%, #a0a0a0 100%);
            border: 8px solid #8b8b8b;
            border-radius: 10px;
        }

        .monitor-1 {
            top: 20%;
            left: 12%;
        }

        .monitor-2 {
            top: 25%;
            right: 15%;
        }

        .crt-screen {
            margin: 15px;
            width: calc(100% - 30px);
            height: 120px;
            background: #001a00;
            border: 2px solid #000;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #00ff00;
            font-size: 0.7rem;
            padding: 10px;
            text-align: center;
        }

        .terminal-base {
            position: absolute;
            bottom: 15%;
            left: 15%;
            width: 180px;
            height: 120px;
            background: #6b6b6b;
            border: 4px solid #4a4a4a;
            border-radius: 5px;
        }

        .keyboard-section {
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            height: 40px;
            background: #3a3a3a;
            border-radius: 3px;
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 2px;
            padding: 4px;
        }

        .key {
            background: #2a2a2a;
            border-radius: 2px;
        }

        /* Main Workstation */
        .workstation {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 600px;
            height: 450px;
            z-index: 10;
        }

        .workstation-desk {
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #8b7355 0%, #654321 100%);
            border: 5px solid #5a4a3a;
            border-radius: 10px;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.9);
        }

        .main-terminal {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 500px;
            height: 350px;
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
            border: 5px solid #4a4a4a;
            border-radius: 8px;
        }

        .terminal-display {
            margin: 20px;
            width: calc(100% - 40px);
            height: calc(100% - 80px);
            background: #0a0a1a;
            border: 3px solid #00ff00;
            border-radius: 5px;
            padding: 15px;
            color: #00ff00;
            font-size: 0.9rem;
            line-height: 1.6;
            overflow-y: auto;
        }

        .terminal-prompt {
            color: #ffd700;
        }

        .cursor-blink {
            animation: cursorBlink 1s steps(2) infinite;
        }

        @keyframes cursorBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        /* Barbara Liskov Character */
        .barbara-character {
            position: absolute;
            top: 45%;
            left: 18%;
            transform: translateY(-50%);
            width: 144px; /* +60% from 90px */
            height: auto; /* for image sizing */
            z-index: 5;
        }

        .barbara-character img {
            width: 100%;
            height: auto;
            display: block;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.25));
        }

        .barbara-outfit {
            width: 100%;
            height: 120px;
            background: linear-gradient(to bottom, #5a3a6a 0%, #3a1a4a 100%);
            position: relative;
            border: 3px solid #4a2a5a;
            border-radius: 10px 10px 60% 60% / 10px 10px 40% 40%;
        }

        .barbara-collar {
            position: absolute;
            top: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 20px;
            background: #f5f5dc;
            border: 2px solid #5a3a6a;
            border-radius: 50% 50% 0 0;
        }

        .barbara-head {
            width: 46px;
            height: 56px;
            background: #ffd1a3;
            border-radius: 50% 50% 45% 45%;
            position: absolute;
            top: -52px;
            left: 50%;
            transform: translateX(-50%);
            border: 2px solid #d4a574;
        }

        .barbara-hair {
            width: 50px;
            height: 38px;
            background: #654321;
            border-radius: 50% 50% 0 0;
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
        }

        .barbara-face-detail {
            position: absolute;
            top: 18px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            text-align: center;
        }

        .barbara-eyes {
            font-size: 8px;
            color: #2a1810;
        }

        .barbara-smile {
            margin-top: 8px;
            font-size: 9px;
            color: #8b4513;
        }

        /* Player Character */
        .player {
            position: absolute;
            bottom: 14%;
            left: 88%; /* moved 30% to the right */
            width: 90px; /* sized for image */
            height: auto;
            opacity: 0;
            transform: translateY(15px);
            animation: playerAppear 1s ease-out forwards; /* remove 8s delay so it appears immediately */
            z-index: 200; /* ensure visible above nearby UI */
        }

        @keyframes playerAppear {
            0% { opacity: 0; transform: scale(0.5) translateY(-50px); }
            50% { opacity: 1; transform: scale(1.2) translateY(-10px); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }

        .player::before {
            content: none;
        }

        .player::after {
            content: none;
        }

        .player img {
            width: 100%;
            height: auto;
            display: block;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.25));
        }
        

        @keyframes guardianGlow {
            0%, 100% { opacity: 0.5; text-shadow: 0 0 10px #ffd700; }
            50% { opacity: 1; text-shadow: 0 0 20px #ffd700; }
        }

        /* Dialogue Box */
        :root {
            --dialog-duration: 0.18s; /* snappy default */
            --dialog-ease: cubic-bezier(.2,.9,.2,1);
            --dialog-opacity-duration: 0.12s;
        }
        .dialogue-box {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(-6px);
            width: 85%;
            max-width: 700px;
            background: rgba(10, 10, 26, 0.95);
            border: 4px solid #9370db;
            border-radius: 15px;
            padding: 25px;
            color: #ffffff;
            display: none;
            z-index: 1000;
            opacity: 0;
            transition: transform var(--dialog-duration) var(--dialog-ease), opacity var(--dialog-opacity-duration) var(--dialog-ease);
            box-shadow: 0 0 30px rgba(147, 112, 219, 0.4);
        }

        .dialogue-box.active {
            display: block;
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .dialogue-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #9370db;
        }

        .dialogue-portrait {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #5a3a6a 0%, #3a1a4a 100%);
            border-radius: 50%;
            border: 3px solid #9370db;
            margin-right: 15px;
        }

        .dialogue-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: #9370db;
        }

        .dialogue-text {
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .dialogue-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .dialogue-btn {
            background: linear-gradient(135deg, #5a3a6a 0%, #3a1a4a 100%);
            border: 2px solid #9370db;
            color: #ffffff;
            padding: 12px 30px;
            font-size: 1rem;
            font-weight: bold;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Courier New', monospace;
        }

        .dialogue-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(147, 112, 219, 0.5);
            background: linear-gradient(135deg, #6a4a7a 0%, #4a2a5a 100%);
        }

        /* Code Editor Interface */
        .code-interface {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.93);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .code-interface.active {
            display: flex;
        }

        .editor-panel {
            background: linear-gradient(135deg, #1a1a2a 0%, #0a0a1a 100%);
            border: 5px solid #9370db;
            border-radius: 20px;
            padding: 30px;
            max-width: 950px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(147, 112, 219, 0.5);
        }

        .editor-title {
            font-size: 1.8rem;
            color: #9370db;
            text-align: center;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(147, 112, 219, 0.5);
        }

        .editor-instruction {
            color: #ffffff;
            text-align: center;
            font-size: 1.1rem;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .class-requirements {
            background: rgba(90, 58, 106, 0.3);
            border: 2px solid #9370db;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            color: #e0e0e0;
        }

        .requirement-title {
            color: #9370db;
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .requirement-list {
            list-style: none;
            padding-left: 20px;
        }

        .requirement-list li {
            margin: 8px 0;
            position: relative;
        }

        .requirement-list li::before {
            content: 'â–¸';
            position: absolute;
            left: -20px;
            color: #ffd700;
        }

        /* Terminal Container */
        .terminal-container {
            background: #0a0a1a;
            border: 3px solid #2a2a3a;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .terminal-header {
            background: #1a1a2a;
            padding: 10px 15px;
            border-bottom: 2px solid #2a2a3a;
        }

        .terminal-title {
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .code-textarea {
            width: 100%;
            min-height: 300px;
            background: #0a0a1a;
            border: none;
            padding: 20px;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            line-height: 1.6;
            resize: vertical;
            outline: none;
        }

        .code-textarea::placeholder {
            color: #4a4a6a;
        }

        .terminal-output {
            background: #1a1a2a;
            border-top: 2px solid #2a2a3a;
            padding: 15px;
            min-height: 150px;
            max-height: 300px;
            overflow-y: auto;
        }

        .output-header {
            color: #9370db;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .output-content {
            color: #ffffff;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .output-content.success {
            color: #00ff00;
        }

        .output-content.error {
            color: #ff6b6b;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .run-code-btn, .clear-code-btn, .finish-btn {
            background: linear-gradient(135deg, #9370db 0%, #6a4a8a 100%);
            border: 3px solid #9370db;
            color: #ffffff;
            padding: 12px 30px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Courier New', monospace;
        }

        .run-code-btn {
            background: linear-gradient(135deg, #00aa00 0%, #007700 100%);
            border-color: #00ff00;
        }

        .clear-code-btn {
            background: linear-gradient(135deg, #666 0%, #444 100%);
            border-color: #888;
        }

        .finish-btn {
            background: linear-gradient(135deg, #ffd700 0%, #ffaa00 100%);
            border-color: #ffd700;
            color: #000000;
        }

        .run-code-btn:hover {
            transform: scale(1.03);
            box-shadow: 0 6px 20px rgba(0, 255, 0, 0.4);
        }

        .clear-code-btn:hover {
            transform: scale(1.03);
            box-shadow: 0 6px 20px rgba(136, 136, 136, 0.4);
        }

        .finish-btn:hover {
            transform: scale(1.03);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
        }

        .hint-section {
            background: rgba(0, 100, 0, 0.2);
            border: 2px solid #00aa00;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }

        .hint-title {
            color: #00ff00;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .hint-text {
            color: #cccccc;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        /* Success Flash */
        .success-flash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(147, 112, 219, 0.8) 0%, transparent 70%);
            opacity: 0;
            pointer-events: none;
            z-index: 2500;
        }

        .success-flash.active {
            animation: flashSuccess 1.5s ease-out;
        }

        @keyframes flashSuccess {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        /* HUD */
        .hud {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(10, 10, 26, 0.9);
            border: 3px solid #9370db;
            border-radius: 10px;
            padding: 15px;
            z-index: 1500;
        }

        .hud-title {
            color: #9370db;
            font-size: 0.9rem;
            margin-bottom: 10px;
            text-align: center;
        }

        .repair-progress {
            display: flex;
            gap: 5px;
        }

        .repair-piece {
            width: 30px;
            height: 30px;
            border: 2px solid #2a2a3a;
            border-radius: 5px;
            background: #0a0a1a;
            transition: all 0.5s ease;
        }

        .repair-piece.active {
            background: linear-gradient(135deg, #9370db 0%, #6a4a8a 100%);
            box-shadow: 0 0 15px rgba(147, 112, 219, 0.8);
            animation: piecePulse 1s ease-out;
            cursor: pointer;
        }

        .repair-piece.active:hover {
            transform: scale(1.15);
            box-shadow: 0 0 25px rgba(147, 112, 219, 1);
            border-color: #a888dd;
        }

        @keyframes piecePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        /* slideUp keyframes removed â€” dialog now uses transform+opacity transitions */
    </style>
</head>
<body>
    <!-- Advanced Level Intro -->
    <div class="advanced-intro" id="advancedIntro">
        <div class="guardian-symbol"></div>
        <h1 class="intro-title">âš¡ ADVANCED LEVEL âš¡</h1>
        <p class="intro-subtitle">The Final Test of the Guardians</p>
        <p class="intro-message">
            2015. A year when courage took center stage.<br><br>
            This was when Caitlyn Jenner came out publicly as a woman â€” a moment that rippled across the world.<br><br>
            Her announcement wasn't just about identityâ€¦ it was about freedom.<br>
            The freedom to live openly.<br>
            The freedom to become who you truly are.<br>
            And the freedom to shape your own future, even when others don't understand.
        </p>
        <p class="ready-message">
            >> Prepare yourself. The Advanced Level begins now... <<
        </p>
    </div>

    <!-- Time Transition -->
    <div class="time-transition" id="timeTransition">
        <div class="digital-grid"></div>
    </div>

    <div id="game-container">
        <!-- University Lab Elements -->
        <div class="crt-monitor monitor-1">
            <div class="crt-screen">
                SYSTEM ONLINE<br>
                DATA TYPES LOADED<br>
                READY FOR INPUT
            </div>
        </div>

        <div class="crt-monitor monitor-2">
            <div class="crt-screen">
                COMPILATION STATUS:<br>
                AWAITING CLASS<br>
                DEFINITION...
            </div>
        </div>

        <div class="terminal-base">
            <div class="keyboard-section">
                <div class="key"></div>
                <div class="key"></div>
                <div class="key"></div>
                <div class="key"></div>
                <div class="key"></div>
                <div class="key"></div>
                <div class="key"></div>
                <div class="key"></div>
            </div>
        </div>

        <!-- Main Workstation -->
        <div class="workstation">
            <div class="workstation-desk">
                <div class="main-terminal">
                    <div class="terminal-display" id="terminalDisplay">
                        <span class="terminal-prompt">SYSTEM:</span> Liskov Substitution Principle active...<br>
                        <span class="terminal-prompt">SYSTEM:</span> Object-oriented environment initialized...<br>
                        <span class="terminal-prompt">SYSTEM:</span> Awaiting class definition...<br>
                        <span class="terminal-prompt cursor-blink">_</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Barbara Liskov Character -->
        <div class="barbara-character">
            <img src="../../assets/Charactercop.png" alt="Left Character" />
        </div>

        <!-- Player Character (now with Guardian aura) -->
        <div class="player">
            <img src="../../assets/Characterpurple.png" alt="Player Character" />
        </div>

        <!-- Dialogue Box -->
        <div class="dialogue-box" id="dialogueBox">
            <div class="dialogue-header">
                <div class="dialogue-portrait"></div>
                <div class="dialogue-name">Dr. Barbara Liskov</div>
            </div>
            <div class="dialogue-text" id="dialogueText"></div>
            <div class="dialogue-buttons" id="dialogueButtons"></div>
        </div>

        <!-- HUD -->
        <div class="hud">
            <div class="hud-title">Time Machine Repair</div>
            <div class="repair-progress">
                <div class="repair-piece" id="piece1" data-scene="SceneOne.html"></div>
                <div class="repair-piece" id="piece2" data-scene="SceneTwo.html"></div>
                <div class="repair-piece" id="piece3" data-scene="SceneThree.html"></div>
                <div class="repair-piece" id="piece4" data-scene="SceneFour.html"></div>
                <div class="repair-piece" id="piece5" data-scene="SceneFive.html"></div>
                <div class="repair-piece" id="piece6" data-scene="SceneSix.html"></div>
                <div class="repair-piece" id="piece7" data-scene="SceneSeven.html"></div>
                <div class="repair-piece" id="piece8" data-scene="SceneEight.html"></div>
            </div>
        </div>
    </div>

    <!-- Code Editor Interface -->
    <div class="code-interface" id="codeInterface">
        <div class="editor-panel">
            <h2 class="editor-title">FREE CODING TERMINAL</h2>
            <p class="editor-instruction">
                Write any code you want using the skills you've learned. Use print statements, variables, 
                conditionals, loops, functions, arrays, and error handling. Express yourself through code!
            </p>

            <div class="terminal-container">
                <div class="terminal-header">
                    <span class="terminal-title">>>> Python Terminal</span>
                </div>
                <textarea 
                    class="code-textarea" 
                    id="codeTextarea" 
                    placeholder="# Write your Python code here...
# Examples:
# print('Hello, World!')
# name = 'Coder'
# for i in range(5):
#     print(i)
# 
# Be creative! Use everything you've learned."
                    spellcheck="false"
                ></textarea>
                
                <div class="terminal-output" id="terminalOutput">
                    <div class="output-header">Output:</div>
                    <div class="output-content" id="outputContent">Ready to run your code...</div>
                </div>
            </div>

            <div class="hint-section">
                <div class="hint-title">ðŸ’¡ What you can use:</div>
                <div class="hint-text">
                    Print statements â€¢ Variables â€¢ Conditionals (if/else) â€¢ Loops (for/while) â€¢ 
                    Functions â€¢ Arrays/Lists â€¢ Error handling (try/except) â€¢ Classes & Objects
                </div>
            </div>

            <div class="button-group">
                <button class="run-code-btn" id="runCodeBtn">â–¶ Run Code</button>
                <button class="clear-code-btn" id="clearCodeBtn">Clear</button>
                <button class="finish-btn" id="finishBtn">I'm Done </button>
            </div>
        </div>
    </div>

    <!-- Success Flash -->
    <div class="success-flash" id="successFlash"></div>

    <script>
        // Game state
        let gameState = {
            advancedStarted: false,
            arrivedAtLab: false,
            metBarbara: false,
            codingStarted: false,
            classComplete: false
        };

        // DOM elements
        const dialogueBox = document.getElementById('dialogueBox');
        const dialogueText = document.getElementById('dialogueText');
        const dialogueButtons = document.getElementById('dialogueButtons');
        const codeInterface = document.getElementById('codeInterface');
        const successFlash = document.getElementById('successFlash');
        const advancedIntro = document.getElementById('advancedIntro');
        const timeTransition = document.getElementById('timeTransition');

        function initializeRepairBoxes() {
            const repairPieces = document.querySelectorAll('.repair-piece');
            repairPieces.forEach(piece => {
                piece.addEventListener('click', () => {
                    // Only navigate if the piece is active (completed)
                    if (piece.classList.contains('active')) {
                        const scene = piece.getAttribute('data-scene');
                        if (scene) {
                            window.location.href = scene;
                        }
                    }
                });
            });
        }

        // Initialize click handlers for all repair boxes
        initializeRepairBoxes();

        function getUserFromLocalStorage() {
            const userStr = localStorage.getItem('user');
            if (userStr) {
                try {
                    return JSON.parse(userStr);
                } catch (e) {
                    console.error('Error parsing user from localStorage:', e);
                    return null;
                }
            }
            return null;
        }

        // Load user progress and update repair boxes
        async function loadUserProgress() {
            try {
                const user = getUserFromLocalStorage();
                if (!user || !user.id) {
                    console.log('No user found in localStorage');
                    return;
                }

                // Fetch user profile to get current progress
                const response = await fetch(`http://localhost:3001/api/users/${user.id}`, {
                    headers: {
                        'Authorization': `Bearer ${user.token}`
                    }
                });

                if (response.ok) {
                    const userData = await response.json();
                    const progress = userData.progress || 0;
                    
                    // Calculate how many levels completed based on progress (12.5% per level)
                    const completedLevels = Math.floor(progress / 12.5);
                    
                    // Since we're on Scene 7, ensure at least boxes 1-6 are filled
                    const currentScene = 7;
                    const boxesToActivate = Math.max(completedLevels, currentScene - 1);
                    
                    // Activate repair boxes for all completed levels
                    // This allows players to click and revisit any completed level
                    for (let i = 1; i <= boxesToActivate; i++) {
                        const piece = document.getElementById(`piece${i}`);
                        if (piece && !piece.classList.contains('active')) {
                            piece.classList.add('active');
                        }
                    }
                    
                    console.log(`âœ… Loaded progress: ${progress}% - ${boxesToActivate} boxes activated`);
                }
            } catch (error) {
                console.error('Error loading user progress:', error);
            }
        }

        // Load progress when page loads
        loadUserProgress();

        // Initialize
        setTimeout(() => {
            advancedIntro.style.display = 'none';
            timeTransition.classList.add('active');
            
            setTimeout(() => {
                timeTransition.classList.remove('active');
                introduceBarbara();
            }, 3500);
        }, 8500);

        function introduceBarbara() {
            gameState.arrivedAtLab = true;
            setTimeout(() => {
                showDialogue(
                    "All throughout history, you've met people who broke barriers â€” not by following the rules, but by daring to rewrite them.<br><br>Caitlyn's story reminds us that becoming your true self takes braveryâ€¦ and once you embrace who you are, you gain something precious â€” freedom.",
                    [{ text: "Continue", action: explainOOP }]
                );
            }, 500);
        }

        function explainOOP() {
            showDialogue(
                "Just like Caitlyn finally got to live openly as herselfâ€¦<br>you now get to code openly as yourself.<br><br>No more drag-and-drop.<br>No more fill-in-the-blanks.<br>No more training wheels.",
                [{ text: "I'm ready", action: explainChallenge }]
            );
        }

        function explainChallenge() {
            showDialogue(
                "From women's rightsâ€¦<br>to equal payâ€¦<br>to space missionsâ€¦<br>to brave individuals living freely and authentically â€”<br>history has shown us that progress comes from courage<br><br>Now it's your turn.<br>Go on â€” write your code.<br>Your future is yours to build",
                [{ text: "Let's code!", action: startCoding }]
            );
        }

        function startCoding() {
            hideDialogue();
            gameState.codingStarted = true;
            codeInterface.classList.add('active');
            initializeCodeEditor();
        }

        function initializeCodeEditor() {
            const codeTextarea = document.getElementById('codeTextarea');
            const runCodeBtn = document.getElementById('runCodeBtn');
            const clearCodeBtn = document.getElementById('clearCodeBtn');
            const finishBtn = document.getElementById('finishBtn');
            const outputContent = document.getElementById('outputContent');

            // Run Code button
            runCodeBtn.addEventListener('click', function() {
                const code = codeTextarea.value.trim();
                
                if (!code) {
                    outputContent.textContent = 'Error: No code to run. Write some Python code first!';
                    outputContent.className = 'output-content error';
                    return;
                }

                // Simulate code execution (basic interpretation)
                try {
                    const result = simulatePythonExecution(code);
                    outputContent.innerHTML = result;
                    outputContent.className = 'output-content success';
                } catch (error) {
                    outputContent.textContent = `Error: ${error.message}`;
                    outputContent.className = 'output-content error';
                }
            });

            // Clear Code button
            clearCodeBtn.addEventListener('click', function() {
                codeTextarea.value = '';
                outputContent.textContent = 'Ready to run your code...';
                outputContent.className = 'output-content';
            });

            // Finish button - go to next level
            finishBtn.addEventListener('click', async function() {
                // Save progress
                try {
                    const user = getUserFromLocalStorage();
                    if (user && user.id) {
                        await updateUserProgress(user.id, 7, 100, true);
                        console.log('âœ… Level 7 Progress Saved');
                    }
                } catch (error) {
                    console.error('Error saving progress:', error);
                }

                // Activate repair piece
                document.getElementById('piece7').classList.add('active');

                // Flash effect
                successFlash.classList.add('active');
                setTimeout(() => {
                    successFlash.classList.remove('active');
                }, 1500);

                // Transition to next level
                setTimeout(() => {
                    codeInterface.classList.remove('active');
                    showDialogue(
                        "Incredible work! You've coded freely, using all the skills you've learned. You've shown true mastery and creative freedom. The final piece of the time machine has been repaired!",
                        [{ text: "Complete the journey", action: () => { window.location.href = 'SceneEight.html'; } }]
                    );
                }, 2000);
            });
        }

        // Simple Python code simulator
        function simulatePythonExecution(code) {
            let output = '';
            const lines = code.split('\n');
            
            // Look for print statements
            const printRegex = /print\s*\(\s*['"](.+?)['"]\s*\)/g;
            let match;
            
            let hasPrint = false;
            while ((match = printRegex.exec(code)) !== null) {
                output += match[1] + '\n';
                hasPrint = true;
            }

            // Check for other patterns
            if (code.includes('for ') && code.includes('range(')) {
                output += 'âœ“ Loop detected\n';
            }
            if (code.includes('if ') || code.includes('else:')) {
                output += 'âœ“ Conditional detected\n';
            }
            if (code.includes('def ')) {
                output += 'âœ“ Function detected\n';
            }
            if (code.includes('class ')) {
                output += 'âœ“ Class detected\n';
            }
            if (code.includes('try:') && code.includes('except')) {
                output += 'âœ“ Error handling detected\n';
            }

            if (!hasPrint && output === '') {
                output = 'âœ“ Code executed successfully!\n(Add print statements to see output)';
            } else if (!hasPrint) {
                output = 'âœ“ Code structure looks good!\n' + output;
            }

            return output || 'âœ“ Code executed!';
        }

        function barbaraWisdom() {
            showDialogue(
                "I developed the concept of data abstraction - hiding implementation details while exposing functionality. The Liskov Substitution Principle states that objects should be replaceable by their subtypes. These aren't just academic ideas - they're how we build reliable, scalable systems. You've proven you understand this.",
                [{ text: "Continue Journey â†’", action: goToNextScene }]
            );
        }

        function goToNextScene() {
            alert("Exceptional work!\n\nYou've written your first complete class from scratch!\n\nNext: Scene 8 - Adele Goldberg (1970s-80s)\n\nYou'll design user interfaces and complete the time machine's visual systems!");
            // In actual implementation:
            window.location.href = 'SceneEight.html';
        }

        // Dialogue system
        function showDialogue(text, buttons) {
            dialogueText.innerHTML = text;
            dialogueButtons.innerHTML = '';
            
            buttons.forEach(btn => {
                const button = document.createElement('button');
                button.className = 'dialogue-btn';
                button.textContent = btn.text;
                button.onclick = btn.action;
                dialogueButtons.appendChild(button);
            });
            
            dialogueBox.classList.add('active');
        }

        function hideDialogue() {
            dialogueBox.classList.remove('active');
        }

        // Helper function to get user from localStorage
        function getUserFromLocalStorage() {
            const userStr = localStorage.getItem('user');
            if (userStr) {
                try {
                    return JSON.parse(userStr);
                } catch (e) {
                    console.error('Error parsing user from localStorage:', e);
                    return null;
                }
            }
            return null;
        }

        // Helper function to update user progress
        async function updateUserProgress(userId, levelId, score, completed) {
            const API_BASE_URL = 'http://localhost:3001';
            const token = localStorage.getItem('token');

            const response = await fetch(`${API_BASE_URL}/api/progress/${userId}/level/${levelId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({ score, completed })
            });

            if (!response.ok) {
                throw new Error('Failed to update progress');
            }

            return response.json();
        }
    </script>
</body>
</html>