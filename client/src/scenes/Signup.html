<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - SHE&lt;Codes/&gt;</title>
    <style>
        /* Reuse the StartScreen theme */
        :root{--bg1:#667eea;--bg2:#764ba2;--accent:#ffd700}
        *{box-sizing:border-box;margin:0;padding:0}
        body{font-family:'Courier New',monospace;background:linear-gradient(135deg,var(--bg1) 0%,var(--bg2) 100%);min-height:100vh;display:flex;align-items:center;justify-content:center;color:#fff}
        .card{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.06);padding:32px;border-radius:12px;width:96%;max-width:480px;box-shadow:0 10px 40px rgba(0,0,0,0.4)}
        h1{font-size:2rem;margin-bottom:8px;text-align:center}
        p.lead{opacity:.9;text-align:center;margin-bottom:18px}
        .form-group{margin-bottom:12px}
        label{display:block;margin-bottom:6px;font-weight:bold}
        input{width:100%;padding:10px;border-radius:6px;border:2px solid var(--accent);background:rgba(255,255,255,0.04);color:#fff;font-family:'Courier New',monospace}
        input::placeholder{color:rgba(255,255,255,0.7)}
        input:focus{outline:none;background:rgba(255,255,255,0.2);box-shadow:0 0 10px rgba(255,215,0,0.5)}
        .btn{padding:12px;border-radius:8px;border:none;cursor:pointer;font-weight:bold;transition:all 0.3s ease;width:100%;margin-top:8px}
        .btn.primary{background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%);color:#fff}
        .btn.primary:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(245,87,108,0.4)}
        .btn.secondary{background:linear-gradient(135deg,#4facfe 0%,#00f2fe 100%);color:#fff;margin-top:0}
        .btn.secondary:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(79,172,254,0.4)}
        .button-row{display:flex;gap:8px;margin-top:8px}
        .button-row .btn{flex:1;margin-top:0}
        .error-message{color:#ff7b7b;margin-top:8px;display:none;font-size:0.9rem}
        .muted{font-size:0.9rem;color:rgba(255,255,255,0.7);text-align:center;margin-top:12px}
        .back{position:absolute;left:20px;top:20px;color:var(--accent);cursor:pointer;font-size:1.2rem}
    </style>
</head>
<body>
    <div class="back" onclick="goBack()">‚Üê Back</div>
    <div class="card">
        <h1>SHE&lt;Codes/&gt;</h1>
        <p class="lead">Create your wizard account to begin your journey through computing history.</p>

        <div id="signup-form">
            <div class="form-group">
                <label for="username">Username</label>
                <input id="username" type="text" placeholder="Your name">
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input id="password" type="password" placeholder="At least 6 characters">
            </div>
            <div id="signupError" style="color:#ff7b7b;margin-top:8px;display:none;font-size:0.9rem"></div>
            <div class="button-row">
                <button class="btn primary" onclick="handleSignup()"> Create Account</button>
            </div>
        </div>

        <p class="muted">By creating an account, you agree to learn and have fun </p>
    </div>

    <script>
        const API_URL = 'http://localhost:3001';

        function goBack(){
            // go back to StartScreen
            window.location.href = 'StartScreen.html';
        }

        async function handleSignup(){
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const err = document.getElementById('signupError');
            err.style.display='none';

            if(!username||!password){ err.textContent='Please fill all fields'; err.style.display='block'; return; }
            if(password.length<6){ err.textContent='Password must be at least 6 characters'; err.style.display='block'; return; }

            try{
                const res = await fetch(`${API_URL}/api/users/register`,{
                    method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username,password})
                });
                const data = await res.json();
                if(!res.ok){ err.textContent = data.error || 'Signup failed'; err.style.display='block'; return; }

                localStorage.setItem('token', data.token);
                localStorage.setItem('user', JSON.stringify(data.user));

                // redirect to IntroScene after successful signup
                window.location.href = 'IntroScene.html';
            }catch(e){ err.textContent='Connection error: '+e.message; err.style.display='block'; }
        }
    </script>
</body>
</html>
