<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scene 9: Margaret Hamilton - SHE<Codes/></title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #0a0a0a;
            overflow: hidden;
            height: 100vh;
        }

        /* Game Container */
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: url('images/apollo-software-room.jpg') center center no-repeat;
            background-size: cover;
            background-color: #1a1a1a;
        }

        /* Time transition */
        .time-transition {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2a 0%, #2a2a4a 50%, #1a1a2a 100%);
            z-index: 3000;
            animation: moonTransition 3s ease-out forwards;
            pointer-events: none;
        }

        @keyframes moonTransition {
            0% { opacity: 1; }
            70% { opacity: 1; }
            100% { opacity: 0; }
        }

        .moon {
            position: absolute;
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #f0f0f0 0%, #a0a0a0 100%);
            top: 20%;
            left: 50%;
            transform: translateX(-50%);
            animation: moonGlow 2s ease-in-out infinite;
        }

        @keyframes moonGlow {
            0%, 100% { box-shadow: 0 0 40px rgba(255, 255, 255, 0.5); }
            50% { box-shadow: 0 0 60px rgba(255, 255, 255, 0.8); }
        }

        /* Software Room Elements */
        .code-stack {
            position: absolute;
            width: 100px;
            background: #f5f5dc;
            border: 3px solid #8b7355;
            box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.5);
        }

        .stack-1 {
            bottom: 15%;
            left: 10%;
            height: 180px;
        }

        .stack-2 {
            bottom: 15%;
            left: 20%;
            height: 220px;
        }

        .stack-3 {
            top: 20%;
            right: 12%;
            height: 200px;
        }

        .stack-4 {
            top: 20%;
            right: 22%;
            height: 160px;
        }

        .paper-lines {
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                transparent,
                transparent 10px,
                #ccc 10px,
                #ccc 11px
            );
        }

        .desk {
            position: absolute;
            bottom: 15%;
            right: 35%;
            width: 180px;
            height: 100px;
            background: #8b7355;
            border: 3px solid #654321;
        }

        /* Apollo Computer Terminal */
        .apollo-terminal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 500px;
            height: 400px;
            z-index: 10;
        }

        .terminal-frame {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
            border: 6px solid #4a4a4a;
            border-radius: 10px;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.9);
        }

        .terminal-screen {
            position: absolute;
            top: 30px;
            left: 30px;
            right: 30px;
            bottom: 80px;
            background: #0a0a1a;
            border: 3px solid #ffd700;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #ff0000;
            font-size: 1.1rem;
            padding: 20px;
            text-align: center;
            line-height: 1.6;
        }

        .error-text {
            animation: errorBlink 1s ease-in-out infinite;
        }

        @keyframes errorBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .priority-indicator {
            position: absolute;
            bottom: 20px;
            left: 30px;
            right: 30px;
            height: 40px;
            background: #1a1a1a;
            border: 2px solid #4a4a4a;
            border-radius: 5px;
            display: flex;
            gap: 5px;
            padding: 5px;
        }

        .priority-light {
            flex: 1;
            background: #2a2a2a;
            border-radius: 3px;
            transition: all 0.3s ease;
        }

        .priority-light.active {
            background: #00ff00;
            box-shadow: 0 0 10px #00ff00;
        }

        .priority-light.error {
            background: #ff0000;
            box-shadow: 0 0 10px #ff0000;
            animation: errorPulse 0.5s ease-in-out infinite;
        }

        @keyframes errorPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Margaret Hamilton Character */
        .margaret-character {
            position: absolute;
            top: 45%;
            left: 18%;
            transform: translateY(-50%);
            width: 90px;
            height: 170px;
            z-index: 5;
        }

        .margaret-outfit {
            width: 100%;
            height: 120px;
            background: linear-gradient(to bottom, #4a4a4a 0%, #2a2a2a 100%);
            position: relative;
            border: 3px solid #3a3a3a;
            border-radius: 8px 8px 60% 60% / 8px 8px 40% 40%;
        }

        .margaret-head {
            width: 44px;
            height: 54px;
            background: #ffd1a3;
            border-radius: 50% 50% 45% 45%;
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            border: 2px solid #d4a574;
        }

        .margaret-hair {
            width: 48px;
            height: 36px;
            background: #654321;
            border-radius: 50% 50% 0 0;
            position: absolute;
            top: -4px;
            left: 50%;
            transform: translateX(-50%);
        }

        .margaret-face-detail {
            position: absolute;
            top: 18px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            text-align: center;
        }

        .margaret-eyes {
            font-size: 8px;
            color: #2a1810;
        }

        .margaret-smile {
            margin-top: 8px;
            font-size: 9px;
            color: #8b4513;
        }

        /* Player Character */
        .player {
            position: absolute;
            bottom: 30%;
            right: 24%;
            width: 50px;
            height: 80px;
            background: linear-gradient(to bottom, #667eea 0%, #4a5aa8 100%);
            border-radius: 25px 25px 10px 10px;
            z-index: 100;
            opacity: 0;
            animation: playerAppear 1s ease-out 3s forwards;
        }

        @keyframes playerAppear {
            0% { opacity: 0; transform: scale(0.5) translateY(-50px); }
            50% { opacity: 1; transform: scale(1.2) translateY(-10px); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }

        .player::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 30px;
            background: #c4d7ff;
            border-radius: 50%;
            border: 2px solid #4a5aa8;
        }

        /* Dialogue Box */
        :root {
            --dialog-duration: 0.18s; /* snappy default */
            --dialog-ease: cubic-bezier(.2,.9,.2,1);
            --dialog-opacity-duration: 0.12s;
        }
        .dialogue-box {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(-6px);
            width: 85%;
            max-width: 700px;
            background: rgba(10, 10, 26, 0.95);
            border: 4px solid #ffd700;
            border-radius: 15px;
            padding: 25px;
            color: #ffffff;
            display: none;
            z-index: 1000;
            opacity: 0;
            transition: transform var(--dialog-duration) var(--dialog-ease), opacity var(--dialog-opacity-duration) var(--dialog-ease);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.4);
        }

        .dialogue-box.active {
            display: block;
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .dialogue-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ffd700;
        }

        .dialogue-portrait {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #4a4a4a 0%, #2a2a2a 100%);
            border-radius: 50%;
            border: 3px solid #ffd700;
            margin-right: 15px;
        }

        .dialogue-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ffd700;
        }

        .dialogue-text {
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .dialogue-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .dialogue-btn {
            background: linear-gradient(135deg, #4a4a4a 0%, #2a2a2a 100%);
            border: 2px solid #ffd700;
            color: #ffffff;
            padding: 12px 30px;
            font-size: 1rem;
            font-weight: bold;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Courier New', monospace;
        }

        .dialogue-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.5);
            background: linear-gradient(135deg, #5a5a5a 0%, #3a3a3a 100%);
        }

        /* Debug Interface */
        .debug-interface {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.93);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .debug-interface.active {
            display: flex;
        }

        .debug-panel {
            background: linear-gradient(135deg, #1a1a2a 0%, #0a0a1a 100%);
            border: 5px solid #ffd700;
            border-radius: 20px;
            padding: 30px;
            max-width: 950px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(255, 215, 0, 0.5);
        }

        .debug-title {
            font-size: 1.8rem;
            color: #ffd700;
            text-align: center;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .debug-instruction {
            color: #ffffff;
            text-align: center;
            font-size: 1.1rem;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .system-status {
            background: rgba(139, 0, 0, 0.3);
            border: 2px solid #ff0000;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 25px;
            color: #ff6666;
            text-align: center;
            font-size: 1rem;
        }

        .flow-builder {
            background: rgba(42, 42, 58, 0.6);
            border: 3px solid #4a4a6a;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .builder-title {
            color: #ffd700;
            font-size: 1.2rem;
            margin-bottom: 15px;
            text-align: center;
        }

        .flow-slots {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .flow-slot {
            min-height: 80px;
            background: #1a1a2a;
            border: 2px dashed #4a4a6a;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            position: relative;
            padding: 10px;
        }

        .flow-slot::before {
            content: attr(data-label);
            position: absolute;
            top: -25px;
            left: 10px;
            font-size: 0.85rem;
            color: #888;
        }

        .flow-slot.filled {
            border-style: solid;
            border-color: #ffd700;
        }

        .flow-slot.valid-drop {
            border-color: #00ff00;
            background: rgba(0, 255, 0, 0.05);
        }

        .available-blocks {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .code-block {
            background: linear-gradient(135deg, #2a2a4a 0%, #1a1a3a 100%);
            border: 3px solid #4a4a6a;
            border-radius: 10px;
            padding: 15px;
            cursor: move;
            user-select: none;
            transition: all 0.3s ease;
            color: #ffffff;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .code-block:hover {
            transform: scale(1.03);
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.3);
            border-color: #ffd700;
        }

        .code-block.dragging {
            opacity: 0.5;
        }

        .code-block.used {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .block-type {
            font-size: 0.75rem;
            color: #ffd700;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .block-if {
            border-color: #ff6b9d;
        }

        .block-else {
            border-color: #4ecdc4;
        }

        .block-try {
            border-color: #95e1d3;
        }

        .block-except {
            border-color: #f38181;
        }

        .execute-debug-btn {
            display: block;
            margin: 20px auto 0;
            background: linear-gradient(135deg, #00ff00 0%, #00aa00 100%);
            border: 3px solid #00ff00;
            color: #000000;
            padding: 15px 50px;
            font-size: 1.3rem;
            font-weight: bold;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Courier New', monospace;
            text-transform: uppercase;
        }

        .execute-debug-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(0, 255, 0, 0.6);
        }

        .execute-debug-btn:disabled {
            background: #333;
            border-color: #555;
            color: #666;
            cursor: not-allowed;
            opacity: 0.5;
        }

        /* Success Flash */
        .success-flash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.8) 0%, transparent 70%);
            opacity: 0;
            pointer-events: none;
            z-index: 2500;
        }

        .success-flash.active {
            animation: flashSuccess 1.5s ease-out;
        }

        @keyframes flashSuccess {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        /* Guardians Reveal */
        .guardians-reveal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3a 50%, #0a0a1a 100%);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            animation: guardiansFadeIn 2s ease-out;
        }

        .guardians-reveal.active {
            display: flex;
        }

        @keyframes guardiansFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .guardians-content {
            text-align: center;
            color: #ffffff;
            max-width: 800px;
            padding: 40px;
        }

        .guardians-title {
            font-size: 3rem;
            color: #ffd700;
            margin-bottom: 30px;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
            animation: titleGlow 2s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { text-shadow: 0 0 30px rgba(255, 215, 0, 0.8); }
            50% { text-shadow: 0 0 50px rgba(255, 215, 0, 1); }
        }

        .guardians-message {
            font-size: 1.3rem;
            line-height: 1.8;
            margin-bottom: 30px;
        }

        .pioneer-icons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
        }

        .pioneer-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid #ffd700;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            background: linear-gradient(135deg, #2a2a4a 0%, #1a1a3a 100%);
            animation: iconFloat 3s ease-in-out infinite;
        }

        .pioneer-icon:nth-child(1) { animation-delay: 0s; }
        .pioneer-icon:nth-child(2) { animation-delay: 0.3s; }
        .pioneer-icon:nth-child(3) { animation-delay: 0.6s; }
        .pioneer-icon:nth-child(4) { animation-delay: 0.9s; }
        .pioneer-icon:nth-child(5) { animation-delay: 1.2s; }
        .pioneer-icon:nth-child(6) { animation-delay: 1.5s; }

        @keyframes iconFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .continue-final-btn {
            background: linear-gradient(135deg, #ffd700 0%, #ffaa00 100%);
            border: 3px solid #ffd700;
            color: #000000;
            padding: 15px 50px;
            font-size: 1.3rem;
            font-weight: bold;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Courier New', monospace;
            margin-top: 30px;
        }

        .continue-final-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.8);
        }

        /* HUD */
        .hud {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(10, 10, 26, 0.9);
            border: 3px solid #ffd700;
            border-radius: 10px;
            padding: 15px;
            z-index: 1500;
        }

        .hud-title {
            color: #ffd700;
            font-size: 0.9rem;
            margin-bottom: 10px;
            text-align: center;
        }

        .repair-progress {
            display: flex;
            gap: 5px;
        }

        .repair-piece {
            width: 30px;
            height: 30px;
            border: 2px solid #2a2a3a;
            border-radius: 5px;
            background: #0a0a1a;
            transition: all 0.5s ease;
        }

        .repair-piece.active {
            background: linear-gradient(135deg, #ffd700 0%, #ffaa00 100%);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
            animation: piecePulse 1s ease-out;
        }

        @keyframes piecePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        /* slideUp keyframes removed ‚Äî dialog now uses transform+opacity transitions */
    </style>
</head>
<body>
    <div id="game-container">
        <!-- Time transition -->
        <div class="time-transition" id="timeTransition">
            <div class="moon"></div>
        </div>

        <!-- Software Room Elements -->
        <div class="code-stack stack-1">
            <div class="paper-lines"></div>
        </div>
        <div class="code-stack stack-2">
            <div class="paper-lines"></div>
        </div>
        <div class="code-stack stack-3">
            <div class="paper-lines"></div>
        </div>
        <div class="code-stack stack-4">
            <div class="paper-lines"></div>
        </div>
        <div class="desk"></div>

        <!-- Apollo Terminal -->
        <div class="apollo-terminal">
            <div class="terminal-frame">
                <div class="terminal-screen" id="terminalScreen">
                    <div class="error-text">
                        ‚ö† SYSTEM ERROR ‚ö†<br>
                        PRIORITY OVERFLOW<br>
                        GUIDANCE SYSTEM UNSTABLE<br>
                        ERROR HANDLING REQUIRED
                    </div>
                </div>
                <div class="priority-indicator">
                    <div class="priority-light error"></div>
                    <div class="priority-light error"></div>
                    <div class="priority-light error"></div>
                    <div class="priority-light error"></div>
                    <div class="priority-light error"></div>
                </div>
            </div>
        </div>

        <!-- Margaret Hamilton Character -->
        <div class="margaret-character">
            <div class="margaret-outfit">
                <div class="margaret-head">
                    <div class="margaret-hair"></div>
                    <div class="margaret-face-detail">
                        <div class="margaret-eyes">‚Ä¢ ‚Ä¢</div>
                        <div class="margaret-smile">‚ó°</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Player Character -->
        <div class="player"></div>

        <!-- Dialogue Box -->
        <div class="dialogue-box" id="dialogueBox">
            <div class="dialogue-header">
                <div class="dialogue-portrait"></div>
                <div class="dialogue-name">Margaret Hamilton</div>
            </div>
            <div class="dialogue-text" id="dialogueText"></div>
            <div class="dialogue-buttons" id="dialogueButtons"></div>
        </div>

        <!-- HUD -->
        <div class="hud">
            <div class="hud-title">Time Machine Repair</div>
            <div class="repair-progress">
                <div class="repair-piece active"></div>
                <div class="repair-piece active"></div>
                <div class="repair-piece active"></div>
                <div class="repair-piece active"></div>
                <div class="repair-piece active"></div>
                <div class="repair-piece" id="piece6"></div>
            </div>
        </div>
    </div>

    <!-- Debug Interface -->
    <div class="debug-interface" id="debugInterface">
        <div class="debug-panel">
            <h2 class="debug-title">APOLLO GUIDANCE SYSTEM DEBUG</h2>
            <p class="debug-instruction">
                Build the error handling flow by dragging conditional and exception blocks into the correct sequence.<br>
                The system must prioritize essential tasks and handle errors gracefully.
            </p>

            <div class="system-status">
                <strong>CRITICAL:</strong> System overload detected | Multiple tasks competing for resources | Must establish priority handling
            </div>

            <div class="flow-builder">
                <div class="builder-title">Error Handling Flow</div>
                <div class="flow-slots">
                    <div class="flow-slot" data-label="Step 1: Check System State" data-position="1"></div>
                    <div class="flow-slot" data-label="Step 2: Handle Critical Priority" data-position="2"></div>
                    <div class="flow-slot" data-label="Step 3: Error Protection" data-position="3"></div>
                    <div class="flow-slot" data-label="Step 4: Fallback Handler" data-position="4"></div>
                    <div class="flow-slot" data-label="Step 5: Normal Operations" data-position="5"></div>
                </div>
            </div>

            <div class="builder-title">Available Code Blocks</div>
            <div class="available-blocks" id="availableBlocks">
                <div class="code-block block-if" draggable="true" data-block="if-priority">
                    <div class="block-type">IF STATEMENT</div>
                    IF task_priority == "CRITICAL":<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;execute_immediately()
                </div>
                <div class="code-block block-else" draggable="true" data-block="else-normal">
                    <div class="block-type">ELSE STATEMENT</div>
                    ELSE:<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;queue_for_later()
                </div>
                <div class="code-block block-try" draggable="true" data-block="try-execute">
                    <div class="block-type">TRY BLOCK</div>
                    TRY:<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;run_guidance_system()
                </div>
                <div class="code-block block-except" draggable="true" data-block="except-overflow">
                    <div class="block-type">EXCEPT BLOCK</div>
                    EXCEPT MemoryOverflow:<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;clear_low_priority_tasks()
                </div>
                <div class="code-block block-if" draggable="true" data-block="if-resources">
                    <div class="block-type">IF STATEMENT</div>
                    IF resources_available():<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;allocate_memory()
                </div>
            </div>

            <button class="execute-debug-btn" id="executeDebugBtn" disabled>Execute Debug Sequence</button>
        </div>
    </div>

    <!-- Guardians Reveal -->
    <div class="guardians-reveal" id="guardiansReveal">
        <div class="guardians-content">
            <h1 class="guardians-title">‚ú¶ THE GUARDIANS OF CODE ‚ú¶</h1>
            <p class="guardians-message">
                You have proven yourself worthy. Each pioneer you've learned from is part of an ancient order - 
                the Guardians of Code. They protect the history of computing and ensure that the knowledge 
                of those who came before is never forgotten. Your time machine was built by them, and your 
                journey has been a test of your skills, determination, and heart.
            </p>
            <div class="pioneer-icons">
                <div class="pioneer-icon" title="Ada Lovelace">üë©‚Äçüíª</div>
                <div class="pioneer-icon" title="Grace Hopper">‚ö°</div>
                <div class="pioneer-icon" title="Alan Turing">üîê</div>
                <div class="pioneer-icon" title="Hedy Lamarr">üì°</div>
                <div class="pioneer-icon" title="Katherine Johnson">üöÄ</div>
                <div class="pioneer-icon" title="Margaret Hamilton">üõ°Ô∏è</div>
            </div>
            <p class="guardians-message">
                You have completed the Intermediate Level and mastered essential programming concepts. 
                The time machine is nearly fully operational. One more level awaits - the Advanced challenges 
                where you will write your own code from scratch and become a true Guardian yourself.
            </p>
            <button class="continue-final-btn" onclick="completeIntermediateLevel()">
                Accept the Challenge ‚Üí
            </button>
        </div>
    </div>

    <!-- Success Flash -->
    <div class="success-flash" id="successFlash"></div>

    <script>
        // Game state
        let gameState = {
            arrivedAtApollo: false,
            metMargaret: false,
            debugActive: false,
            debugComplete: false,
            correctSequence: ['if-priority', 'try-execute', 'except-overflow', 'if-resources', 'else-normal'],
            currentSequence: [null, null, null, null, null]
        };

        // DOM elements
        const dialogueBox = document.getElementById('dialogueBox');
        const dialogueText = document.getElementById('dialogueText');
        const dialogueButtons = document.getElementById('dialogueButtons');
        const debugInterface = document.getElementById('debugInterface');
        const executeDebugBtn = document.getElementById('executeDebugBtn');
        const terminalScreen = document.getElementById('terminalScreen');
        const guardiansReveal = document.getElementById('guardiansReveal');
        const successFlash = document.getElementById('successFlash');
        const timeTransition = document.getElementById('timeTransition');

        // Initialize
        setTimeout(() => {
            timeTransition.style.display = 'none';
            introduceMargaret();
        }, 3500);

        function introduceMargaret() {
            gameState.arrivedAtApollo = true;
            setTimeout(() => {
                showDialogue(
                    "Welcome to the Apollo program. We're facing a critical system error - the guidance computer is experiencing priority overflow. During the moon landing, we had seconds to prevent a crash. The software must handle errors gracefully and prioritize what's truly essential. Can you help debug the system?",
                    [{ text: "What needs to be done?", action: explainProblem }]
                );
            }, 500);
        }

        function explainProblem() {
            showDialogue(
                "The system is trying to do too many things at once. We need conditional logic to check priorities and error handling to catch problems before they crash the entire system. Think of it like triage - what must happen immediately, what can wait, and what do we do if something goes wrong?",
                [{ text: "I'll help debug it!", action: startDebug }]
            );
        }

        function startDebug() {
            hideDialogue();
            gameState.debugActive = true;
            debugInterface.classList.add('active');
            initializeDebugInterface();
        }

        // Drag and Drop System
        let draggedElement = null;

        function initializeDebugInterface() {
            const blocks = document.querySelectorAll('.code-block');
            const slots = document.querySelectorAll('.flow-slot');
            
            blocks.forEach(block => {
                block.addEventListener('dragstart', handleDragStart);
                block.addEventListener('dragend', handleDragEnd);
            });

            slots.forEach(slot => {
                slot.addEventListener('dragover', handleDragOver);
                slot.addEventListener('drop', handleDrop);
                slot.addEventListener('dragleave', handleDragLeave);
            });

            executeDebugBtn.addEventListener('click', executeDebug);
        }

        function handleDragStart(e) {
            if (this.classList.contains('used')) return;
            draggedElement = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            this.classList.add('valid-drop');
            return false;
        }

        function handleDragLeave(e) {
            this.classList.remove('valid-drop');
        }

        function handleDrop(e) {
            e.stopPropagation();
            e.preventDefault();
            
            this.classList.remove('valid-drop');
            
            if (!draggedElement) return;
            
            const position = parseInt(this.getAttribute('data-position'));
            const blockId = draggedElement.getAttribute('data-block');
            
            // Check if slot is already filled
            if (this.classList.contains('filled')) {
                this.innerHTML = '';
                gameState.currentSequence[position - 1] = null;
            }
            
            // Clone and place the block
            const clonedBlock = draggedElement.cloneNode(true);
            clonedBlock.draggable = false;
            clonedBlock.style.cursor = 'pointer';
            clonedBlock.style.margin = '0';
            clonedBlock.style.transform = 'scale(0.95)';
            
            // Add click to remove
            clonedBlock.addEventListener('click', function() {
                this.parentElement.innerHTML = '';
                this.parentElement.classList.remove('filled');
                gameState.currentSequence[position - 1] = null;
                draggedElement.classList.remove('used');
                updateDebugButton();
            });
            
            this.innerHTML = '';
            this.appendChild(clonedBlock);
            this.classList.add('filled');
            
            // Mark original as used
            draggedElement.classList.add('used');
            
            // Update sequence
            gameState.currentSequence[position - 1] = blockId;
            updateDebugButton();
            
            return false;
        }

        function updateDebugButton() {
            const allFilled = gameState.currentSequence.every(slot => slot !== null);
            executeDebugBtn.disabled = !allFilled;
        }

        function executeDebug() {
            // Check if sequence is correct
            let isCorrect = true;
            
            for (let i = 0; i < gameState.correctSequence.length; i++) {
                if (gameState.currentSequence[i] !== gameState.correctSequence[i]) {
                    isCorrect = false;
                    break;
                }
            }
            
            if (isCorrect) {
                debugSuccess();
            } else {
                debugFailed();
            }
        }

        function debugFailed() {
            terminalScreen.innerHTML = `
                <div class="error-text">
                    ‚úó DEBUG FAILED ‚úó<br>
                    INCORRECT ERROR HANDLING SEQUENCE<br>
                    SYSTEM STILL UNSTABLE<br>
                    <br>
                    <span style="font-size: 0.9rem;">Review the flow: Check priorities first, handle execution, catch errors, check resources, then handle normal tasks.</span>
                </div>
            `;
            
            // Shake animation
            debugInterface.querySelector('.debug-panel').style.animation = 'shake 0.5s';
            
            setTimeout(() => {
                terminalScreen.innerHTML = `
                    <div class="error-text">
                        ‚ö† SYSTEM ERROR ‚ö†<br>
                        PRIORITY OVERFLOW<br>
                        GUIDANCE SYSTEM UNSTABLE<br>
                        ERROR HANDLING REQUIRED
                    </div>
                `;
                debugInterface.querySelector('.debug-panel').style.animation = '';
            }, 3000);
        }

        function debugSuccess() {
            gameState.debugComplete = true;
            
            // Update terminal
            terminalScreen.innerHTML = `
                <div style="color: #00ff00; animation: none;">
                    ‚úì DEBUG SUCCESSFUL ‚úì<br>
                    ERROR HANDLING ACTIVE<br>
                    PRIORITIES MANAGED<br>
                    SYSTEM STABLE
                </div>
            `;
            
            // Activate priority lights sequentially
            const lights = document.querySelectorAll('.priority-light');
            lights.forEach((light, index) => {
                setTimeout(() => {
                    light.classList.remove('error');
                    light.classList.add('active');
                }, index * 300);
            });
            
            // Flash effect
            setTimeout(() => {
                successFlash.classList.add('active');
                setTimeout(() => {
                    successFlash.classList.remove('active');
                }, 1500);
                
                // Repair time machine
                setTimeout(() => {
                    document.getElementById('piece6').classList.add('active');
                    
                    setTimeout(() => {
                        debugInterface.classList.remove('active');
                        completeScene();
                    }, 1500);
                }, 1000);
            }, 2000);
        }

        function completeScene() {
            showDialogue(
                "Excellent work! The error handling is perfect. In that critical moment during Apollo 11, our software's ability to prioritize and handle errors saved the mission. You understand now - good code isn't just about when things work, it's about gracefully handling when they don't.",
                [{ text: "Tell me more...", action: margaretWisdom }]
            );
        }

        function margaretWisdom() {
            showDialogue(
                "They said software engineering wasn't a real discipline. That it didn't deserve the same rigor as other engineering fields. But I knew that lives depended on our code being perfect. Every line mattered. Every error case had to be handled. You've proven you understand this too.",
                [{ text: "What happens now?", action: revealGuardians }]
            );
        }

        function revealGuardians() {
            hideDialogue();
            
            setTimeout(() => {
                guardiansReveal.classList.add('active');
            }, 500);
        }

        function completeIntermediateLevel() {
            alert("üéâ INTERMEDIATE LEVEL COMPLETE! üéâ\n\nYou have mastered:\n‚Ä¢ Arrays and Patterns (Hedy Lamarr)\n‚Ä¢ Functions and Loops (Katherine Johnson)\n‚Ä¢ Error Handling and Conditionals (Margaret Hamilton)\n\nYour journey continues to the Advanced Level where you will write complete programs from scratch!");
            window.location.href = 'SceneSeven.html';
        }

        // Dialogue system
        function showDialogue(text, buttons) {
            dialogueText.textContent = text;
            dialogueButtons.innerHTML = '';
            
            buttons.forEach(btn => {
                const button = document.createElement('button');
                button.className = 'dialogue-btn';
                button.textContent = btn.text;
                button.onclick = btn.action;
                dialogueButtons.appendChild(button);
            });
            
            dialogueBox.classList.add('active');
        }

        function hideDialogue() {
            dialogueBox.classList.remove('active');
        }

        // Add shake animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
                20%, 40%, 60%, 80% { transform: translateX(10px); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>